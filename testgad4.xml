<?xml version="1.0" encoding="UTF-8" ?>
<Module>
    <ModulePrefs
            title="Test"
            author="JH"
            thumbnail="https://www.redmineup.com/cms/assets/thumbnail/33796/600/jira_logo.png"
            screenshot="https://www.redmineup.com/cms/assets/thumbnail/33796/600/jira_logo.png"
            description="JIRA Server Dashboard Description">

        <Require feature="minimessage" />
        <Require feature="dynamic-height" />
        <Require feature="auth-refresh"/>
        <Require feature="oauthpopup" />
        <Require feature="setprefs" />
        <Require feature="settitle" />
        <Require feature="core" />
        <Require feature="core.io" />
        <Require feature="views" />
        <Optional feature="atlassian.util" />
        <Optional feature="gadget-directory">
            <Param name="categories">Other</Param>
        </Optional>
    </ModulePrefs>
    <UserPref name="filterID" display_name="Filter (ID)" datatype="string" default_value=""/>
    <UserPref name="beginFieldName" display_name="Beginn (Feldname)" datatype="string" default_value="Beginn"/>
    <UserPref name="endFieldName" display_name="Ende (Feldname)" datatype="string" default_value="Ende"/>
    <UserPref name="beginDate" display_name="Beginn-Datum (Beispiel 2013-05-24; -3w; +1m)" datatype="string" default_value="2013-01-01"/>
    <UserPref name="endDate" display_name="Ende-Datum (Beispiel 2013-05-24; -3w; +1m)" datatype="string" default_value="2013-12-31"/>
    <UserPref name="fieldNames" display_name="Feldname:Breite (feld1:100;feld2:50)" datatype="string" default_value=""/>
    <Content type="html">
        <![CDATA[
 <script type="text/javascript" src="https://code.jquery.com/jquery-1.7.2.min.js"></script>
 <script>
    <script type="text/javascript">
 var gadget = AJS.Gadget({
        baseUrl: "https://avst-prod511.adaptavist.cloud",
        useOauth: "/rest/gadget/1.0/currentUser",
        view: {
            template: function(args) {
                var gadget = this;

                var htmlList = AJS.$("<ul/>");

                AJS.$(args.ganttData.html).each(function() {
                    htmlList.append(this.html);
                });
                gadget.getView().html(htmlList);
            },
            args: [{
                key: "ganttData",
                ajaxOptions: function() {
                    return {
                        url: "/rest/gantt-gadget/1.0/html.json",
                        data: {
                            filterID : this.getPref("filterID"),
                            beginFieldName : this.getPref("beginFieldName"),
                            endFieldName : this.getPref("endFieldName"),
                            beginDate : this.getPref("beginDate"),
                            endDate : this.getPref("endDate"),
                            fieldNames : this.getPref("fieldNames")
                        }
                    };
                }
            }]
        }
    });
    </script>
<script>
function refresh() {
jQuery.ajax({
 type: "GET",
 dataType: "json",
                   "contentType": "application/json",
                   url: "https://avst-prod511.adaptavist.cloud/rest/scriptrunner/latest/custom/gadgetEndpoint",
                   data: "d"
                 }).done(function(data) {
                    $("#eth").append(JSON.stringify(data))
                 }).fail(function() {
                    $("#eth").append("Something Went Wrong")
});
}

refresh();
</script>
<div id="eth"></div>
]]>
    </Content>
</Module>