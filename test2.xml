<?xml version="1.0" encoding="UTF-8" ?>
<Module>
    <ModulePrefs
            title="Test"
            author="JH"
            thumbnail="https://www.redmineup.com/cms/assets/thumbnail/33796/600/jira_logo.png"
            screenshot="https://www.redmineup.com/cms/assets/thumbnail/33796/600/jira_logo.png"
            description="JIRA Server Dashboard Description">

        <Require feature="minimessage" />
        <Require feature="dynamic-height" />
        <Require feature="auth-refresh"/>
        <Require feature="oauthpopup" />
        <Require feature="setprefs" />
        <Require feature="settitle" />
        <Require feature="core" />
        <Require feature="core.io" />
        <Require feature="views" />
        <Optional feature="atlassian.util" />
        <Optional feature="gadget-directory">
            <Param name="categories">Other</Param>
        </Optional>
        <OAuth>
            <Service>
                <Access url="https://avst-prod511.adaptavist.cloud/plugins/servlet/oauth/access-token" method="POST"/>
                <Request url="https://avst-prod511.adaptavist.cloud/plugins/servlet/oauth/request-token" method="POST"/>
                <Authorization url="https://avst-prod511.adaptavist.cloud/plugins/servlet/oauth/authorize?oauth_callback=http%3A%2F%2Foauth.gmodules.com%2Fgadgets%2Foauthcallback"/>
            </Service>
        </OAuth>
    </ModulePrefs>
    <UserPref name="isConfigured" datatype="hidden" default_value="false"/>
    <UserPref name="projectid" datatype="hidden"/>
    <UserPref name="fieldId" datatype="hidden"/>
    <UserPref name="refresh" datatype="hidden" default_value="false"/>
    <Content type="html">
        <![CDATA[
 <script type="text/javascript" src="https://code.jquery.com/jquery-1.7.2.min.js"></script>
    <script type="text/javascript" src="https://code.jquery.com/jquery-1.7.2.min.js">
AJS.Gadget({
  baseUrl: "https://avst-prod511.adaptavist.cloud",
  useOauth: "/rest/gadget/1.0/currentUser",
  config: {
    descriptor: function(args) {
      var gadget = this;
      return {
        action: "/rest/gadget/1.0/issueTable/jql/validate",
        theme: function() {
          if (gadgets.window.getViewportDimensions().width < 450) {
            return "gdt top-label";
          } else {
            return "gdt";
          }
        }(),
        fields: [AJS.gadget.fields.numberToShow(gadget, "num"), columnGadgetFieldType(gadget, "columnNames", args.columnChoices.availableColumns), AJS.gadget.fields.nowConfigured()]
      };
    },
    args: [{
      key: "columnChoices",
      ajaxOptions: "/rest/gadget/1.0/availableColumns"
    }, ]
  },
  view: {
    onResizeAdjustHeight: true,
    enableReload: true,
    template: function(args) {
      var gadget = this;
      this.getView().empty();
      this.getView().attr("id", "in-progress");
      var view = AJS.$("<div/>").attr("id", "jira").appendTo(this.getView());
      var linkStart = "<a href=\"https://avst-prod511.adaptavist.cloud/issues/?jql=status+%3D+%27In+Progress%27+AND+resolution+is+EMPTY+AND+assignee+in+%28currentUser%28%29%29+ORDER+BY+priority+DESC%2C+created+ASC\" target=\"_parent\" title=\"__MSG_gadget.in.progress.title__\">";
      var linkEnd = "</a>";
      if (args.issueTable.displayed != 0) {
        if (args.issueTable.displayed === args.issueTable.total) {
          view.append(AJS.$("<div/>").addClass("results-wrap").append(AJS.$("<div/>").html(args.issueTable.table)));
        } else {
          view.append(AJS.$("<div/>").addClass("results-wrap").append(AJS.$("<div/>").addClass("paging-table").html(args.issueTable.table)));
        }
        $resultCountLink = view.find(".results-count-link");
        $resultCountLink.replaceWith(AJS.$(linkStart + $resultCountLink.html() + linkEnd));
        AJS.$("th.sortable").each(function() {
          this.onclick = null;
        }).click(function() {
          gadget.sortBy = AJS.$(this).attr("rel");
          gadget.showView(true);
        });
        AJS.$(".pagination a").click(function(event) {
          event.preventDefault();
          gadget.startIndex = AJS.$(this).attr("rel");
          gadget.showView(true);
        });
        if (gadget.isLocal()) {
          if (typeof contextPath === "undefined") {
            contextPath = "https://avst-prod511.adaptavist.cloud";
          }
          AJS.Dropdown.create({
            trigger: ".issue-actions-trigger",
            autoScroll: false,
            ajaxOptions: {
              dataType: "json",
              cache: false,
              formatSuccess: JIRA.FRAGMENTS.issueActionsFragment
            }
          });
        }
      } else {
        gadget.getView().append(AJS.$("<div/>").addClass("empty-results").append(AJS.format("__MSG_gadget.issuetable.common.empty__", linkStart, "</a>")));
      }("#issuetable tr").hover(function() {
        jQuery(this).addClass("hover");
      }, function() {
        if (!AJS.dropDown.current) {
          jQuery(this).removeClass("hover");
        }
      });
      gadget.resize();
    },
    args: [{
      key: "issueTable",
      ajaxOptions: function() {
        var gadget = this;
        var columnNames = gadget.getPrefArray("columnNames");
        var hasDefault = false;
        var indexOf = -1;
        for (var i = 0; i < columnNames.length; i++) {
          if (columnNames[i] === "--Default--") {
            hasDefault = true;
            indexOf = i;
            break;
          }
        }
        if (hasDefault) {
          columnNames.splice(indexOf, 1);
        }
        if (!this.sortBy) {
          this.sortBy = null;
        }
        return {
          url: "/rest/gadget/1.0/issueTable/jql",
          data: {
            jql: "status = 'In Progress' AND resolution is EMPTY AND assignee = currentUser() ORDER BY priority DESC, created ASC",
            num: this.getPref("num"),
            addDefault: hasDefault,
            enableSorting: true,
            sortBy: function() {
              if (gadget.sortBy && gadget.sortBy !== "") {
                return gadget.sortBy;
              } else {
                return null;
              }
            }(),
            columnNames: columnNames,
            paging: true,
            startIndex: function() {
              if (gadget.startIndex && gadget.startIndex !== "") {
                return gadget.startIndex;
              } else {
                return "0";
              }
            }(),
            showActions: gadget.isLocal()
          }
        };
      }
    }]
  }
});

    </script>
]]>
    </Content>
</Module>